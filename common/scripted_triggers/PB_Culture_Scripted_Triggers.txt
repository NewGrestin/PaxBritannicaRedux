is_muslim_culture = {
    OR = {
        check_variable = {
            culture_token = token:kurdish
        }
        check_variable = {
            culture_token = token:levantine
        }
        check_variable = {
            culture_token = token:persian
        }
        check_variable = {
            culture_token = token:arabian_gulf
        }
        check_variable = {
            culture_token = token:shia_arab
        }
        check_variable = {
            culture_token = token:sunni_arab
        }
        check_variable = {
            culture_token = token:yemen
        }
        check_variable = {
            culture_token = token:omani
        }
        check_variable = {
            culture_token = token:riffian
        }
        check_variable = {
            culture_token = token:moroccan
        }
        check_variable = {
            culture_token = token:lebanese
        }
        check_variable = {
            culture_token = token:algerian
        }
        check_variable = {
            culture_token = token:berber
        }
        check_variable = {
            culture_token = token:sahwari
        }
        check_variable = {
            culture_token = token:tunisian
        }
        check_variable = {
            culture_token = token:tripolitanian
        }
        check_variable = {
            culture_token = token:cyrenican
        }
        check_variable = {
            culture_token = token:egyptian
        }
    }
}

PB_culture_calculate_main_culture_modifiers = {
    all_controlled_state = {
        if = {
            limit = {
                check_variable = { culture_token = PREV.PB_main_culture }
            }
            add_to_temp_variable = { percent_main_culture = state_population_k }
        }
    }
    divide_temp_variable = { percent_main_culture = max_manpower_k }
    all_of = {
        array = global.culture_modifiers@var:PB_main_culture
        value = current_modifier
        set_temp_variable = { actual@var:current_modifier = global.culture_modifier_values@var:PB_main_culture^i }
        multiply_temp_variable = { actual@var:current_modifier = percent_main_culture }
    }
}

modifier_is_percent = {
    modifier_is_flat = no
}

modifier_is_flat = {
    OR = {
        check_variable = { temp_modifier = token:research_sharing_per_country_bonus }
        check_variable = { temp_modifier = token:max_surrender_limit_offset }
        check_variable = { temp_modifier = token:min_export }
        check_variable = { temp_modifier = token:political_power_cost }
        check_variable = { temp_modifier = token:political_power_gain }
        check_variable = { temp_modifier = token:power_balance_daily }
        check_variable = { temp_modifier = token:power_balance_weekly }
        check_variable = { temp_modifier = token:civil_war_involvement_tension }
        check_variable = { temp_modifier = token:enemy_declare_war_tension }
        check_variable = { temp_modifier = token:generate_wargoal_tension }
        check_variable = { temp_modifier = token:guarantee_tension }
        check_variable = { temp_modifier = token:join_faction_tension }
        check_variable = { temp_modifier = token:lend_lease_tension }
        check_variable = { temp_modifier = token:opinion_gain_monthly }
        check_variable = { temp_modifier = token:opinion_gain_monthly_same_ideology }
        check_variable = { temp_modifier = token:send_volunteer_size }
        check_variable = { temp_modifier = token:send_volunteers_tension }
        check_variable = { temp_modifier = token:air_volunteer_cap }
        check_variable = { temp_modifier = token:autonomy_gain }
        check_variable = { temp_modifier = token:subjects_autonomy_gain }
        check_variable = { temp_modifier = token:autonomy_gain_ll_to_overlord }
        check_variable = { temp_modifier = token:autonomy_gain_ll_to_subject }
        check_variable = { temp_modifier = token:autonomy_gain_trade }
        check_variable = { temp_modifier = token:autonomy_gain_warscore }
        check_variable = { temp_modifier = token:master_ideology_drift }
        check_variable = { temp_modifier = token:dockyard_donations }
        check_variable = { temp_modifier = token:industrial_factory_donations }
        check_variable = { temp_modifier = token:military_factory_donations }
        check_variable = { temp_modifier = token:legitimacy_daily }
        check_variable = { temp_modifier = token:equipment_capture }
        check_variable = { temp_modifier = token:floating_harbor_duration }
        check_variable = { temp_modifier = token:floating_harbor_range }
        check_variable = { temp_modifier = token:floating_harbor_supply }
        check_variable = { temp_modifier = token:base_fuel_gain }
        check_variable = { temp_modifier = token:fuel_cost }
        check_variable = { temp_modifier = token:fuel_gain }
        check_variable = { temp_modifier = token:fuel_gain }
        check_variable = { temp_modifier = token:fuel_gain_from_states }
        check_variable = { temp_modifier = token:max_fuel }
        check_variable = { temp_modifier = token:no_supply_grace }
        check_variable = { temp_modifier = token:heat_attrition }
        check_variable = { temp_modifier = token:winter_attrition }
        check_variable = { temp_modifier = token:extra_marine_supply_grace }
        check_variable = { temp_modifier = token:extra_paratrooper_supply_grace }
        check_variable = { temp_modifier = token:special_forces_no_supply_grace }
        check_variable = { temp_modifier = token:truck_attrition }
        check_variable = { temp_modifier = token:civilian_factory_use }
        check_variable = { temp_modifier = token:global_building_slots }
        check_variable = { temp_modifier = token:decryption }
        check_variable = { temp_modifier = token:encryption }
        check_variable = { temp_modifier = token:intel_network_gain }
        check_variable = { temp_modifier = token:crypto_strength }
        check_variable = { temp_modifier = token:decryption_power }
        check_variable = { temp_modifier = token:decryption_power }
        check_variable = { temp_modifier = token:intel_network_gain }
        check_variable = { temp_modifier = token:own_operative_detection_chance }
        check_variable = { temp_modifier = token:enemy_operative_detection_chance }
        check_variable = { temp_modifier = token:new_operative_slot_bonus }
        check_variable = { temp_modifier = token:operative_slot }
        check_variable = { temp_modifier = token:command_power_gain }
        check_variable = { temp_modifier = token:conscription }
        check_variable = { temp_modifier = token:experience_gain_army }
        check_variable = { temp_modifier = token:experience_gain_navy }
        check_variable = { temp_modifier = token:experience_gain_air }
        check_variable = { temp_modifier = token:max_command_power }
        check_variable = { temp_modifier = token:weekly_manpower }
        check_variable = { temp_modifier = token:refit_ic_cost }
        check_variable = { temp_modifier = token:choose_preferred_tactics_cost }
        check_variable = { temp_modifier = token:assign_army_leader_cp_cost }
        check_variable = { temp_modifier = token:army_leader_start_level }
        check_variable = { temp_modifier = token:army_leader_start_attack_level }
        check_variable = { temp_modifier = token:army_leader_start_defense_level }
        check_variable = { temp_modifier = token:army_leader_start_logistics_level }
        check_variable = { temp_modifier = token:army_leader_start_planning_level }
        check_variable = { temp_modifier = token:assign_navy_leader_cp_cost }
        check_variable = { temp_modifier = token:navy_leader_start_level }
        check_variable = { temp_modifier = token:navy_leader_start_attack_level }
        check_variable = { temp_modifier = token:navy_leader_start_coordination_level }
        check_variable = { temp_modifier = token:navy_leader_start_defense_level }
        check_variable = { temp_modifier = token:navy_leader_start_maneuvering_level }
        check_variable = { temp_modifier = token:female_divisional_commander_chance }
        check_variable = { temp_modifier = token:army_morale }
        check_variable = { temp_modifier = token:army_org }
        check_variable = { temp_modifier = token:dig_in_speed }
        check_variable = { temp_modifier = token:experience_gain_army_unit }
        check_variable = { temp_modifier = token:max_dig_in }
        check_variable = { temp_modifier = token:max_planning }
        check_variable = { temp_modifier = token:special_forces_min }
        check_variable = { temp_modifier = token:naval_invasion_prep_speed }
        check_variable = { temp_modifier = token:naval_invasion_capacity }
        check_variable = { temp_modifier = token:experience_gain_navy_unit }
        check_variable = { temp_modifier = token:navy_anti_air_attack }
        check_variable = { temp_modifier = token:naval_enemy_positioning_in_initial_attack }
        check_variable = { temp_modifier = token:naval_morale }
        check_variable = { temp_modifier = token:navy_org }
        check_variable = { temp_modifier = token:navy_max_range }
        check_variable = { temp_modifier = token:carrier_sortie_hours_delay }
        check_variable = { temp_modifier = token:generate_wargoal_tension_against }
        check_variable = { temp_modifier = token:targeted_legitimacy_daily }
        check_variable = { temp_modifier = token:compliance_gain }
        check_variable = { temp_modifier = token:local_building_slots }
        check_variable = { temp_modifier = token:recruitable_population }
        check_variable = { temp_modifier = token:enemy_operative_detection_chance_over_occupied_tag }
        check_variable = { temp_modifier = token:max_commander_army_size }
        check_variable = { temp_modifier = token:max_army_group_size }
        check_variable = { temp_modifier = token:air_accidents }
        check_variable = { temp_modifier = token:air_detection }
        check_variable = { temp_modifier = token:naval_strike }
    }
}

modifier_is_good = {
    modifier_is_ambivalent = no
    modifier_is_bad = no
}

modifier_is_ambivalent = {
    OR = {
        check_variable = { temp_modifier = token:consumer_goods_factor }
        check_variable = { temp_modifier = token:civil_war_involvement_tension }
        check_variable = { temp_modifier = token:enemy_declare_war_tension }
        check_variable = { temp_modifier = token:generate_wargoal_tension }
        check_variable = { temp_modifier = token:guarantee_tension }
        check_variable = { temp_modifier = token:join_faction_tension }
        check_variable = { temp_modifier = token:lend_lease_tension }
        check_variable = { temp_modifier = token:request_lease_tension }
        check_variable = { temp_modifier = token:send_volunteers_tension }
        check_variable = { temp_modifier = token:generate_wargoal_tension_against }
        check_variable = { temp_modifier = token:air_volunteer_cap }
        check_variable = { temp_modifier = token:embargo_threshold_factor }
        check_variable = { temp_modifier = token:ai_badass_factor }
        check_variable = { temp_modifier = token:ai_call_ally_desire_factor }
        check_variable = { temp_modifier = token:ai_desired_divisions_factor }
        check_variable = { temp_modifier = token:ai_focus_aggressive_factor }
        check_variable = { temp_modifier = token:ai_focus_defense_factor }
        check_variable = { temp_modifier = token:ai_focus_aviation_factor }
        check_variable = { temp_modifier = token:ai_focus_military_advancements_factor }
        check_variable = { temp_modifier = token:ai_focus_military_equipment_factor }
        check_variable = { temp_modifier = token:ai_focus_naval_air_factor }
        check_variable = { temp_modifier = token:ai_focus_naval_factor }
        check_variable = { temp_modifier = token:ai_focus_peaceful_factor }
        check_variable = { temp_modifier = token:ai_focus_war_production_factor }
        check_variable = { temp_modifier = token:ai_get_ally_desire_factor }
        check_variable = { temp_modifier = token:ai_join_ally_desire_factor }
        check_variable = { temp_modifier = token:ai_license_acceptance }
    }
}

modifier_is_bad = {
    OR = {
        check_variable = { temp_modifier = token:disabled_ideas }
        check_variable = { temp_modifier = token:disable_strategic_redeployment }
        check_variable = { temp_modifier = token:disable_strategic_redeployment_for_controller }
        check_variable = { temp_modifier = token:cannot_use_abilities }
        check_variable = { temp_modifier = token:unit_leader_as_advisor_cp_cost_factor }
        check_variable = { temp_modifier = token:improve_relations_maintain_cost_factor }
        check_variable = { temp_modifier = token:max_surrender_limit_offset }
        check_variable = { temp_modifier = token:forced_surrender_limit }
        check_variable = { temp_modifier = token:offensive_war_stability_factor }
        check_variable = { temp_modifier = token:war_stability_factor }
        check_variable = { temp_modifier = token:defensive_war_stability_factor }
        check_variable = { temp_modifier = token:unit_leader_as_advisor_cp_cost_factor }
        check_variable = { temp_modifier = token:improve_relations_maintain_cost_factor }
        check_variable = { temp_modifier = token:political_power_cost }
        check_variable = { temp_modifier = token:guarantee_cost }
        check_variable = { temp_modifier = token:annex_cost_factor }
        check_variable = { temp_modifier = token:puppet_cost_factor }
        check_variable = { temp_modifier = token:embargo_cost_factor }
        check_variable = { temp_modifier = token:license_subject_master_purchase_cost }
        check_variable = { temp_modifier = token:overlord_trade_cost_factor }
        check_variable = { temp_modifier = token:equipment_upgrade_xp_cost }
        check_variable = { temp_modifier = token:license_purchase_cost }
        check_variable = { temp_modifier = token:license_purchase_cost_factor }
        check_variable = { temp_modifier = token:license_purchase_cost_factor }
        check_variable = { temp_modifier = token:fuel_cost }
        check_variable = { temp_modifier = token:conversion_cost_civ_to_mil_factor }
        check_variable = { temp_modifier = token:conversion_cost_mil_to_civ_factor }
        check_variable = { temp_modifier = token:operation_cost }
        check_variable = { temp_modifier = token:land_equipment_upgrade_xp_cost }
        check_variable = { temp_modifier = token:naval_equipment_upgrade_xp_cost }
        check_variable = { temp_modifier = token:refit_ic_cost }
        check_variable = { temp_modifier = token:air_equipment_upgrade_xp_cost }
        check_variable = { temp_modifier = token:choose_preferred_tactics_cost }
        check_variable = { temp_modifier = token:command_abilities_cost_factor }
        check_variable = { temp_modifier = token:assign_army_leader_cp_cost }
        check_variable = { temp_modifier = token:army_leader_cost_factor }
        check_variable = { temp_modifier = token:military_leader_cost_factor }
        check_variable = { temp_modifier = token:assign_navy_leader_cp_cost }
        check_variable = { temp_modifier = token:navy_leader_cost_factor }
        check_variable = { temp_modifier = token:grant_medal_cost_factor }
        check_variable = { temp_modifier = token:trade_cost_for_target_factor }
        check_variable = { temp_modifier = token:promote_cost_factor }
        check_variable = { temp_modifier = token:max_training }
        check_variable = { temp_modifier = token:send_volunteer_divisions_required }
        check_variable = { temp_modifier = token:required_garrison_factor }
        check_variable = { temp_modifier = token:invasion_preparation }
        check_variable = { temp_modifier = token:justify_war_goal_time }
        check_variable = { temp_modifier = token:justify_war_goal_when_in_major_war_time }
        check_variable = { temp_modifier = token:agency_upgrade_time }
        check_variable = { temp_modifier = token:own_operative_forced_into_hiding_time_factor }
        check_variable = { temp_modifier = token:own_operative_harmed_time_factor }
        check_variable = { temp_modifier = token:enemy_operative_forced_into_hiding_time_factor }
        check_variable = { temp_modifier = token:enemy_operative_harmed_time_factor }
        check_variable = { temp_modifier = token:training_time_factor }
        check_variable = { temp_modifier = token:training_time_army_factor }
        check_variable = { temp_modifier = token:special_forces_training_time_factor }
        check_variable = { temp_modifier = token:production_lack_of_resource_penalty_factor }
        check_variable = { temp_modifier = token:field_officer_promotion_penalty }
        check_variable = { temp_modifier = token:pocket_penalty }
        check_variable = { temp_modifier = token:naval_invasion_penalty }
        check_variable = { temp_modifier = token:naval_enemy_fleet_size_ratio_penalty_factor }
        check_variable = { temp_modifier = token:navy_weather_penalty }
        check_variable = { temp_modifier = token:air_carrier_night_penalty_reduction_factor }
        check_variable = { temp_modifier = token:carrier_capacity_penalty_reduction }
        check_variable = { temp_modifier = token:air_night_penalty }
        check_variable = { temp_modifier = token:air_strategic_bomber_night_penalty }
        check_variable = { temp_modifier = token:air_untrained_pilots_penalty_factor }
        check_variable = { temp_modifier = token:air_weather_penalty }
        check_variable = { temp_modifier = token:army_fuel_consumption_factor }
        check_variable = { temp_modifier = token:air_fuel_consumption_factor }
        check_variable = { temp_modifier = token:navy_fuel_consumption_factor }
        check_variable = { temp_modifier = token:supply_consumption_factor }
        check_variable = { temp_modifier = token:supply_combat_penalties_on_core_factor }
        check_variable = { temp_modifier = token:attrition }
        check_variable = { temp_modifier = token:unit_upkeep_attrition_factor }
        check_variable = { temp_modifier = token:naval_attrition }
        check_variable = { temp_modifier = token:heat_attrition }
        check_variable = { temp_modifier = token:heat_attrition }
        check_variable = { temp_modifier = token:heat_attrition_factor }
        check_variable = { temp_modifier = token:winter_attrition }
        check_variable = { temp_modifier = token:winter_attrition_factor }
        check_variable = { temp_modifier = token:truck_attrition }
        check_variable = { temp_modifier = token:truck_attrition_factor }
        check_variable = { temp_modifier = token:attrition_for_controller }
        check_variable = { temp_modifier = token:civilian_factory_use }
        check_variable = { temp_modifier = token:industry_air_damage_factor }
        check_variable = { temp_modifier = token:tech_air_damage_factor }
        check_variable = { temp_modifier = token:compliance_growth_on_our_occupied_states }
        check_variable = { temp_modifier = token:resistance_activity }
        check_variable = { temp_modifier = token:resistance_target }
        check_variable = { temp_modifier = token:airforce_intel_to_others }
        check_variable = { temp_modifier = token:army_intel_to_others }
        check_variable = { temp_modifier = token:civilian_intel_to_others }
        check_variable = { temp_modifier = token:navy_intel_to_others }
        check_variable = { temp_modifier = token:foreign_subversive_activites }
        check_variable = { temp_modifier = token:subversive_activites_upkeep }
        check_variable = { temp_modifier = token:operation_risk }
        check_variable = { temp_modifier = token:defense_impact_on_blueprint_stealing }
        check_variable = { temp_modifier = token:own_operative_capture_chance_factor }
        check_variable = { temp_modifier = token:own_operative_detection_chance }
        check_variable = { temp_modifier = token:own_operative_detection_chance_factor }
        check_variable = { temp_modifier = token:own_operative_forced_into_hiding_time_factor }
        check_variable = { temp_modifier = token:own_operative_harmed_time_factor }
        check_variable = { temp_modifier = token:enemy_operative_intel_extraction_rate }
        check_variable = { temp_modifier = token:operative_death_on_capture_chance }
        check_variable = { temp_modifier = token:land_doctrine_cost_factor }
        check_variable = { temp_modifier = token:naval_doctrine_cost_factor }
        check_variable = { temp_modifier = token:air_doctrine_cost_factor }
        check_variable = { temp_modifier = token:combat_width_factor }
        check_variable = { temp_modifier = token:experience_loss_factor }
        check_variable = { temp_modifier = token:org_loss_at_low_org_factor }
        check_variable = { temp_modifier = token:org_loss_when_moving }
        check_variable = { temp_modifier = token:critical_receive_chance }
        check_variable = { temp_modifier = token:naval_accidents_chance }
        check_variable = { temp_modifier = token:naval_critical_effect_factor }
        check_variable = { temp_modifier = token:naval_enemy_retreat_chance }
        check_variable = { temp_modifier = token:naval_torpedo_enemy_critical_chance_factor }
        check_variable = { temp_modifier = token:strike_force_movement_org_loss }
        check_variable = { temp_modifier = token:carrier_capacity_penalty_reduction }
        check_variable = { temp_modifier = token:air_accidents_factor }
        check_variable = { temp_modifier = token:air_manpower_requirement_factor }
        check_variable = { temp_modifier = token:air_wing_xp_loss_when_killed_factor }
        check_variable = { temp_modifier = token:enemy_army_bonus_air_superiority_factor }
        check_variable = { temp_modifier = token:country_resource_cost_oil }
        check_variable = { temp_modifier = token:country_resource_cost_aluminium }
        check_variable = { temp_modifier = token:country_resource_cost_rubber }
        check_variable = { temp_modifier = token:country_resource_cost_tungsten }
        check_variable = { temp_modifier = token:country_resource_cost_steel }
        check_variable = { temp_modifier = token:country_resource_cost_strategic_minerals }
        check_variable = { temp_modifier = token:country_resource_cost_uranium }
        check_variable = { temp_modifier = token:enemy_intel_network_gain_factor_over_occupied_tag }
        check_variable = { temp_modifier = token:local_factory_sabotage }
        check_variable = { temp_modifier = token:local_intel_to_enemies }
        check_variable = { temp_modifier = token:resistance_damage_to_garrison }
        check_variable = { temp_modifier = token:resistance_garrison_penetration_chance }
        check_variable = { temp_modifier = token:resistance_growth }
        check_variable = { temp_modifier = token:state_resource_cost_oil }
        check_variable = { temp_modifier = token:state_resource_cost_aluminium }
        check_variable = { temp_modifier = token:state_resource_cost_rubber }
        check_variable = { temp_modifier = token:state_resource_cost_tungsten }
        check_variable = { temp_modifier = token:state_resource_cost_steel }
        check_variable = { temp_modifier = token:state_resource_cost_strategic_minerals }
        check_variable = { temp_modifier = token:state_resource_cost_uranium }
        check_variable = { temp_modifier = token:reassignment_duration_factor }
        check_variable = { temp_modifier = token:river_crossing_factor }
        check_variable = { temp_modifier = token:sickness_chance }
        check_variable = { temp_modifier = token:wounded_chance_factor }
        check_variable = { temp_modifier = token:air_accidents }
        check_variable = { temp_modifier = token:navy_casualty_on_hit }
        check_variable = { temp_modifier = token:navy_casualty_on_sink }
    }
}