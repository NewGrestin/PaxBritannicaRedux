scripted_gui = {
	PB_social_development_menu_open = {
		window_name = "PB_social_development_menu_open"
		context_type = player_context
		parent_window_name = countrypoliticsview

		effects = {
			PB_social_development_menu_open_button_click = {
				if = {
					limit = { has_country_flag = PB_social_development_menu_open }
					clr_country_flag = PB_social_development_menu_open
					custom_effect_tooltip = PB_social_development_menu_close_tt
				}
				else = {
					set_country_flag = PB_social_development_menu_open
					custom_effect_tooltip = PB_social_development_menu_open_tt
				}
			}
		}
	}

	PB_social_development_menu = {
		window_name = "PB_social_development_menu"
		context_type = player_context
		parent_window_name = "countrypoliticsview_anchor"
		visible = { has_country_flag = PB_social_development_menu_open }

		effects = {
			PB_social_development_menu_close_button_click = {
				if = {
					limit = { has_country_flag = PB_social_development_menu_open }
					clr_country_flag = PB_social_development_menu_open
					custom_effect_tooltip = PB_social_development_menu_close_tt
				}
				else = {
					set_country_flag = PB_social_development_menu_open
					custom_effect_tooltip = PB_social_development_menu_open_tt
				}
			}
		}

		triggers = {
			PB_social_development_progress_bar_visible = {
				check_variable = { PB_social_development_progress^category > 0 }
				if = {
					limit = {
						all_of = {
							array = PB_social_development_progress
							check_variable = { i < category }
							add_to_temp_variable = { prev_progress = v }
						}
					}
				}
				set_temp_variable = { PB_social_development_progress_bar_frame = prev_progress }
				multiply_temp_variable = { PB_social_development_progress_bar_frame = 1000 }
				add_to_temp_variable = { PB_social_development_progress_bar_frame = PB_social_development_progress^category }
			}
			PB_social_development_progress_tracker_click_enabled = {
				set_temp_variable = { PB_social_development_progress_tracker_x = PB_social_development_progress^category }
				multiply_temp_variable = { PB_social_development_progress_tracker_x = 5 }
			}
			PB_social_development_monthly_change_visible = {
				set_temp_variable = { category_token = token:social_development_category_poverty }
				add_to_temp_variable = { category_token = category }
				meta_trigger = {
					text = {
						set_temp_variable = { category_monthly_change = modifier@[CATEGORY_TOKEN]_monthly }
					}
					CATEGORY_TOKEN = "[?category_token.GetTokenKey]"
				}
				check_variable = { var = category_monthly_change value = 0 compare = not_equals }
				if = {
					limit = {
						check_variable = { category_monthly_change > 0.25 }
					}
					set_temp_variable = { PB_social_development_monthly_change_frame = 1 }
				}
				else_if = {
					limit = {
						check_variable = { category_monthly_change > 0.10 }
					}
					set_temp_variable = { PB_social_development_monthly_change_frame = 2 }
				}
				else_if = {
					limit = {
						check_variable = { category_monthly_change > 0 }
					}
					set_temp_variable = { PB_social_development_monthly_change_frame = 3 }
				}
				else_if = {
					limit = {
						check_variable = { category_monthly_change < -0.25 }
					}
					set_temp_variable = { PB_social_development_monthly_change_frame = 4 }
				}
				else_if = {
					limit = {
						check_variable = { category_monthly_change < -0.10 }
					}
					set_temp_variable = { PB_social_development_monthly_change_frame = 5 }
				}
				else = {
					set_temp_variable = { PB_social_development_monthly_change_frame = 6 }
				}
				if = {
					limit = {
						check_variable = { category_monthly_change > 0 }
					}
					set_temp_variable = { PB_social_development_monthly_change_x = 120 }
				}
				else = {
					set_temp_variable = { PB_social_development_monthly_change_x = -120 }
				}
			}
		}

		effects = {
			PB_social_development_current_level_click = {
				set_variable = { selected_category = category }
				set_country_flag = PB_social_development_levels_menu_open
				custom_effect_tooltip = PB_social_development_menu_open_tt
			}
		}

		properties = {
			PB_social_development_progress_bar = {
				frame = PB_social_development_progress_bar_frame
			}
			PB_social_development_progress_tracker = {
				x = PB_social_development_progress_tracker_x
			}
			PB_social_development_monthly_change = {
				x = PB_social_development_monthly_change_x
				frame = PB_social_development_monthly_change_frame
			}
			PB_social_development_current_level = {
				image = "GFX_[?category_token.GetTokenKey]_level_[?level]"
			}
		}

		dynamic_lists = {
			PB_social_development_gridbox = {
				array = PB_social_development
				value = level
				index = category
				entry_container = "PB_social_development_entry"
			}
		}
	}

	PB_social_development_levels_menu = {
		window_name = "PB_social_development_levels_menu"
		context_type = player_context
		parent_scripted_gui = PB_social_development_menu
		visible = { has_country_flag = PB_social_development_levels_menu_open }

		triggers = {
			PB_social_development_levels_calculator_click_enabled = {
				set_temp_variable = { category_token = token:social_development_category_poverty }
				add_to_temp_variable = { category_token = selected_category }
				meta_trigger = {
					text = {
						resize_temp_array = { PB_social_development_levels_temp = constant:PB_social_development_categories.[TOKEN].num_of_levels }
					}
					TOKEN = "[?category_token.GetTokenKey]"
				}
			}
			PB_social_development_current_level_shine_visible = {
				check_variable = { PB_social_development^selected_category = level }
			}
		}

		properties = {
			PB_social_development_current_level = {
				image = "GFX_[?category_token.GetTokenKey]_level_[?level]"
			}
		}

		dynamic_lists = {
			PB_social_development_level_gridbox = {
				array = PB_social_development_levels_temp
				value = level
				entry_container = "PB_social_development_level_entry"
			}
		}
	}

	PB_social_development_map_mode_toggle = {
		window_name = "PB_social_development_map_mode_toggle"
		context_type = player_context
		dirty = selected_social_development_map_mode_toggle
		mapmode = social_development_map_mode

		triggers = {
			toggle_social_development_map_mode_button_click_enabled = {
				check_variable = { var = selected_social_development_map_mode_toggle value = current_toggle compare = not_equals }
			}
			temp_array_calculator_click_enabled = {
				resize_temp_array = { social_development_map_mode_toggles_temp_array = 6 }
			}
		}

		properties = {
			#toggle_social_development_map_mode_button = {
			#	image = "GFX_social_development_map_mode_toggle_[?current_toggle]"
			#}
		}

		effects = {
			toggle_social_development_map_mode_button_click = {
				set_variable = { selected_social_development_map_mode_toggle = current_toggle }
				force_update_map_mode = {
					limit = { is_ai = no }
					mapmode = social_development_map_mode
				}
			}
		}

		dynamic_lists = {
			social_development_map_mode_toggles_gridbox = {
				array = social_development_map_mode_toggles_temp_array
				index = current_toggle
				entry_container = "social_development_map_mode_toggles_entry"
			}
		}

		ai_enabled = { always = no }
	}
}